{
  "last_node_id": 25,
  "last_link_id": 35,
  "nodes": [
    {
      "id": 1,
      "type": "LoadImage",
      "pos": [50, 50],
      "size": {"0": 315, "1": 314},
      "flags": {},
      "order": 0,
      "mode": 0,
      "outputs": [
        {"name": "IMAGE", "type": "IMAGE", "links": [1, 2, 3, 4], "slot_index": 0},
        {"name": "MASK", "type": "MASK", "links": null}
      ],
      "properties": {"Node name for S&R": "LoadImage"},
      "widgets_values": ["360_panorama.jpg"],
      "title": "üåê Load 360¬∞ Panorama"
    },
    {
      "id": 2,
      "type": "DownloadAndLoadMoGeModel",
      "pos": [400, 50],
      "size": {"0": 315, "1": 106},
      "flags": {},
      "order": 1,
      "mode": 0,
      "outputs": [
        {"name": "moge_model", "type": "MOGEMODEL", "links": [5], "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "DownloadAndLoadMoGeModel"},
      "widgets_values": ["MoGe_ViT_L_fp16.safetensors", "fp16"],
      "title": "üì¶ Load MoGe Model"
    },
    {
      "id": 3,
      "type": "Pano_TileSampler_Spherical",
      "pos": [50, 400],
      "size": {"0": 315, "1": 226},
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [
        {"name": "erp_image", "type": "IMAGE", "link": 1}
      ],
      "outputs": [
        {"name": "tiles", "type": "TILE_BATCH", "links": [6], "slot_index": 0},
        {"name": "tile_params", "type": "TILE_PARAMS", "links": [7], "slot_index": 1},
        {"name": "sample_preview", "type": "IMAGE", "links": null}
      ],
      "properties": {"Node name for S&R": "Pano_TileSampler_Spherical"},
      "widgets_values": [4, 2, 90, 15, 768, "bilinear", true],
      "title": "üîß 360¬∞ Tile Sampler (4x2 grid)"
    },
    {
      "id": 4,
      "type": "MoGe_PerTile_Geometry",
      "pos": [400, 400],
      "size": {"0": 315, "1": 166},
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [
        {"name": "moge_model", "type": "MOGEMODEL", "link": 5},
        {"name": "tiles", "type": "TILE_BATCH", "link": 6},
        {"name": "tile_params", "type": "TILE_PARAMS", "link": 7}
      ],
      "outputs": [
        {"name": "tile_depths", "type": "DEPTH_BATCH", "links": [8], "slot_index": 0},
        {"name": "tile_normals", "type": "NORMAL_BATCH", "links": [9], "slot_index": 1}
      ],
      "properties": {"Node name for S&R": "MoGe_PerTile_Geometry"},
      "widgets_values": [8, 2, true, true],
      "title": "üß† MoGe Per-Tile Geometry"
    },
    {
      "id": 5,
      "type": "Depth_Normal_Stitcher_360",
      "pos": [750, 400],
      "size": {"0": 315, "1": 186},
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [
        {"name": "tile_depths", "type": "DEPTH_BATCH", "link": 8},
        {"name": "tile_normals", "type": "NORMAL_BATCH", "link": 9},
        {"name": "tile_params", "type": "TILE_PARAMS", "link": 7}
      ],
      "outputs": [
        {"name": "erp_depth", "type": "IMAGE", "links": [10, 11], "slot_index": 0},
        {"name": "erp_normals", "type": "IMAGE", "links": null, "slot_index": 1},
        {"name": "stitch_preview", "type": "IMAGE", "links": null}
      ],
      "properties": {"Node name for S&R": "Depth_Normal_Stitcher_360"},
      "widgets_values": [1024, "weighted_blend", 0.15, true, true],
      "title": "üß© 360¬∞ Depth/Normal Stitcher"
    },
    {
      "id": 6,
      "type": "OWLViT_Detect_360",
      "pos": [50, 700],
      "size": {"0": 315, "1": 226},
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [
        {"name": "erp_image", "type": "IMAGE", "link": 2}
      ],
      "outputs": [
        {"name": "detection_boxes", "type": "DETECTION_BOXES", "links": [12], "slot_index": 0},
        {"name": "detection_preview", "type": "IMAGE", "links": null, "slot_index": 1},
        {"name": "detection_summary", "type": "STRING", "links": null}
      ],
      "properties": {"Node name for S&R": "OWLViT_Detect_360"},
      "widgets_values": ["mountain peak, rock formation, tree, building, person", 0.25, 0.5, "circular_padding", 20, "base"],
      "title": "üéØ OWL-ViT 360¬∞ Object Detector"
    },
    {
      "id": 7,
      "type": "Boxes_To_ZIM_Mattes",
      "pos": [400, 700],
      "size": {"0": 315, "1": 186},
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [
        {"name": "erp_image", "type": "IMAGE", "link": 3},
        {"name": "detection_boxes", "type": "DETECTION_BOXES", "link": 12}
      ],
      "outputs": [
        {"name": "object_masks", "type": "IMAGE", "links": [13], "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "Boxes_To_ZIM_Mattes"},
      "widgets_values": ["grabcut", 1.2, 2.0, 100, 5, 10],
      "title": "üé≠ Detection Boxes ‚Üí Object Masks"
    },
    {
      "id": 8,
      "type": "Sky_Background_Splitter",
      "pos": [750, 700],
      "size": {"0": 315, "1": 186},
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [
        {"name": "erp_image", "type": "IMAGE", "link": 4}
      ],
      "outputs": [
        {"name": "sky_mask", "type": "IMAGE", "links": [14], "slot_index": 0},
        {"name": "background_mask", "type": "IMAGE", "links": [15], "slot_index": 1},
        {"name": "combined_preview", "type": "IMAGE", "links": null}
      ],
      "properties": {"Node name for S&R": "Sky_Background_Splitter"},
      "widgets_values": ["auto", 0.4, 0.0, 0.05, 0.35],
      "title": "üåÖ Sky/Background Splitter"
    },
    {
      "id": 9,
      "type": "Layer_Builder_360",
      "pos": [1100, 400],
      "size": {"0": 315, "1": 246},
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [
        {"name": "erp_image", "type": "IMAGE", "link": 1},
        {"name": "erp_depth", "type": "IMAGE", "link": 10},
        {"name": "sky_mask", "type": "IMAGE", "link": 14},
        {"name": "background_mask", "type": "IMAGE", "link": 15},
        {"name": "object_masks", "type": "IMAGE", "link": 13}
      ],
      "outputs": [
        {"name": "layer_stack", "type": "LAYER_STACK", "links": [16], "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "Layer_Builder_360"},
      "widgets_values": [1000.0, 1.0, "sky_back", true],
      "title": "üèóÔ∏è 360¬∞ Layer Builder"
    },
    {
      "id": 10,
      "type": "Layer_Complete_360",
      "pos": [1450, 400],
      "size": {"0": 315, "1": 186},
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [
        {"name": "layer_stack", "type": "LAYER_STACK", "link": 16}
      ],
      "outputs": [
        {"name": "completed_layers", "type": "LAYER_STACK", "links": [17], "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "Layer_Complete_360"},
      "widgets_values": ["opencv_telea", 5, 0.8, true, "balanced"],
      "title": "üé® 360¬∞ Layer Completion"
    },
    {
      "id": 11,
      "type": "Layer_Alpha_Refiner",
      "pos": [1450, 650],
      "size": {"0": 315, "1": 166},
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [
        {"name": "layer_stack", "type": "LAYER_STACK", "link": 17}
      ],
      "outputs": [
        {"name": "refined_layers", "type": "LAYER_STACK", "links": [18], "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "Layer_Alpha_Refiner"},
      "widgets_values": ["bilateral", 2.0, 0.1, true, 50],
      "title": "‚ú® 360¬∞ Alpha Refiner"
    },
    {
      "id": 12,
      "type": "Layer_Mesher_Spherical",
      "pos": [1800, 400],
      "size": {"0": 315, "1": 286},
      "flags": {},
      "order": 11,
      "mode": 0,
      "inputs": [
        {"name": "layer_stack", "type": "LAYER_STACK", "link": 18}
      ],
      "outputs": [
        {"name": "spherical_mesh", "type": "TRIMESH", "links": [19], "slot_index": 0},
        {"name": "sphere_depth", "type": "IMAGE", "links": null},
        {"name": "sphere_normals", "type": "IMAGE", "links": null}
      ],
      "properties": {"Node name for S&R": "Layer_Mesher_Spherical"},
      "widgets_values": [1024, "all", 1.0, true, true, 0.0, 0.8, false],
      "title": "üåê 360¬∞ Layer Mesher"
    },
    {
      "id": 13,
      "type": "Spherical_Mesh_Exporter",
      "pos": [2150, 400],
      "size": {"0": 315, "1": 146},
      "flags": {},
      "order": 12,
      "mode": 0,
      "inputs": [
        {"name": "mesh", "type": "TRIMESH", "link": 19}
      ],
      "outputs": [
        {"name": "file_path", "type": "STRING", "links": null, "slot_index": 0}
      ],
      "properties": {"Node name for S&R": "Spherical_Mesh_Exporter"},
      "widgets_values": ["glb", "3D/Complete_360_Layered", true, true],
      "title": "üíæ Spherical Mesh Exporter"
    },
    {
      "id": 14,
      "type": "PreviewImage",
      "pos": [400, 950],
      "size": {"0": 315, "1": 246},
      "flags": {},
      "order": 13,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 6}
      ],
      "properties": {"Node name for S&R": "PreviewImage"},
      "title": "üëÅÔ∏è Tiles Preview"
    },
    {
      "id": 15,
      "type": "PreviewImage",
      "pos": [750, 950],
      "size": {"0": 315, "1": 246},
      "flags": {},
      "order": 14,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 11}
      ],
      "properties": {"Node name for S&R": "PreviewImage"},
      "title": "üìä Depth Preview"
    },
    {
      "id": 16,
      "type": "PreviewImage",
      "pos": [1100, 950],
      "size": {"0": 315, "1": 246},
      "flags": {},
      "order": 15,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 12}
      ],
      "properties": {"Node name for S&R": "PreviewImage"},
      "title": "üéØ Detection Preview"
    },
    {
      "id": 17,
      "type": "ShowText|pysssss",
      "pos": [2150, 600],
      "size": {"0": 315, "1": 76},
      "flags": {},
      "order": 16,
      "mode": 0,
      "inputs": [
        {"name": "text", "type": "STRING", "link": 19}
      ],
      "properties": {"Node name for S&R": "ShowText|pysssss"},
      "title": "üìÑ Export Path"
    },
    {
      "id": 18,
      "type": "Note",
      "pos": [50, 1250],
      "size": {"0": 400, "1": 200},
      "flags": {},
      "order": 17,
      "mode": 0,
      "properties": {"Node name for S&R": "Note"},
      "widgets_values": ["üåê Complete 360¬∞ Layered Pipeline\n\nüìã Workflow Steps:\n1. Load 360¬∞ panorama\n2. Sample perspective tiles (4x2 grid)\n3. Run MoGe on each tile for depth/normals\n4. Stitch tiles back to ERP format\n5. Detect objects with OWL-ViT\n6. Convert detection boxes to masks\n7. Split sky/background regions\n8. Build structured layers\n9. Complete layers with inpainting\n10. Refine alpha masks\n11. Generate layered mesh\n12. Export to GLB\n\n‚ö° Performance Tips:\n- Reduce tile grid to 3x2 for speed\n- Lower MoGe resolution to 7 for faster inference\n- Use 'fast' quality mode for quick tests\n\nüéØ Expected Output:\n- High-quality layered 3D mesh with separate geometry for sky, background, and detected objects\n- Proper ERP seam continuity throughout\n- Clean object separation for better geometry quality"],
      "title": "üìñ Pipeline Documentation",
      "color": "#232",
      "bgcolor": "#353"
    },
    {
      "id": 19,
      "type": "Note",
      "pos": [500, 1250],
      "size": {"0": 350, "1": 150},
      "flags": {},
      "order": 18,
      "mode": 0,
      "properties": {"Node name for S&R": "Note"},
      "widgets_values": ["‚öôÔ∏è Optimization Settings:\n\nFor FASTER processing (at slight quality cost):\n‚Ä¢ Tile Grid: 3x2 or 4x2 (instead of 6x3)\n‚Ä¢ Tile Size: 512px (instead of 768px)\n‚Ä¢ MoGe Resolution: 7 (instead of 8-9)\n‚Ä¢ Quality Mode: 'fast' (instead of 'balanced')\n‚Ä¢ Mesh Resolution: 512 (instead of 1024)\n\nFor HIGHER quality (slower):\n‚Ä¢ Tile Grid: 6x3 with more overlap\n‚Ä¢ MoGe Resolution: 9\n‚Ä¢ Quality Mode: 'high'\n‚Ä¢ Use 'patch_match' inpainting"],
      "title": "‚ö° Speed vs Quality",
      "color": "#423",
      "bgcolor": "#534"
    },
    {
      "id": 20,
      "type": "Note",
      "pos": [900, 1250],
      "size": {"0": 350, "1": 120},
      "flags": {},
      "order": 19,
      "mode": 0,
      "properties": {"Node name for S&R": "Note"},
      "widgets_values": ["üéØ Object Detection Tips:\n\n‚Ä¢ Use specific queries: 'mountain peak, rock formation, large boulder, tree, building'\n‚Ä¢ Lower confidence (0.15-0.25) finds more objects\n‚Ä¢ 'circular_padding' mode handles seam objects best\n‚Ä¢ 'perspective_tiles' mode is most thorough but slower\n\nüí° For mountain panoramas, try:\n'rocky outcrop, cliff face, prominent peak, large tree, stone formation'"],
      "title": "üéØ Detection Tips",
      "color": "#324",
      "bgcolor": "#435"
    },
    {
      "id": 21,
      "type": "Note",
      "pos": [1300, 1250],
      "size": {"0": 350, "1": 120},
      "flags": {},
      "order": 20,
      "mode": 0,
      "properties": {"Node name for S&R": "Note"},
      "widgets_values": ["üèóÔ∏è Layer System Benefits:\n\n‚úÖ Separate geometry for sky, terrain, objects\n‚úÖ Clean object boundaries vs. terrain\n‚úÖ Better depth consistency per layer\n‚úÖ Individual layer mesh optimization\n‚úÖ Proper occlusion handling with inpainting\n\nüé® Inpainting fills holes where objects were removed from background, creating complete layers for better meshing."],
      "title": "üèóÔ∏è Layer Benefits",
      "color": "#243",
      "bgcolor": "#354"
    },
    {
      "id": 22,
      "type": "Note",
      "pos": [1700, 1250],
      "size": {"0": 350, "1": 100},
      "flags": {},
      "order": 21,
      "mode": 0,
      "properties": {"Node name for S&R": "Note"},
      "widgets_values": ["üíæ Output Formats:\n\n‚Ä¢ GLB: Best for web viewers, Blender, game engines\n‚Ä¢ PLY: Good for MeshLab, CloudCompare\n‚Ä¢ OBJ: Universal compatibility\n\nüìê Mesh includes proper UV mapping and PBR materials with the original panorama texture applied spherically."],
      "title": "üíæ Export Info",
      "color": "#234",
      "bgcolor": "#345"
    }
  ],
  "links": [
    [1, 1, 0, 3, 0, "IMAGE"],
    [2, 1, 0, 6, 0, "IMAGE"],
    [3, 1, 0, 7, 0, "IMAGE"],
    [4, 1, 0, 8, 0, "IMAGE"],
    [5, 2, 0, 4, 0, "MOGEMODEL"],
    [6, 3, 0, 4, 1, "TILE_BATCH"],
    [7, 3, 1, 4, 2, "TILE_PARAMS"],
    [7, 3, 1, 5, 2, "TILE_PARAMS"],
    [8, 4, 0, 5, 0, "DEPTH_BATCH"],
    [9, 4, 1, 5, 1, "NORMAL_BATCH"],
    [10, 5, 0, 9, 1, "IMAGE"],
    [11, 5, 0, 15, 0, "IMAGE"],
    [12, 6, 0, 7, 1, "DETECTION_BOXES"],
    [12, 6, 1, 16, 0, "IMAGE"],
    [13, 7, 0, 9, 4, "IMAGE"],
    [14, 8, 0, 9, 2, "IMAGE"],
    [15, 8, 1, 9, 3, "IMAGE"],
    [16, 9, 0, 10, 0, "LAYER_STACK"],
    [17, 10, 0, 11, 0, "LAYER_STACK"],
    [18, 11, 0, 12, 0, "LAYER_STACK"],
    [19, 12, 0, 13, 0, "TRIMESH"],
    [19, 13, 0, 17, 0, "STRING"]
  ],
  "groups": [
    {
      "title": "üì• Input & Model Loading",
      "bounding": [25, 25, 715, 175],
      "color": "#3f789e"
    },
    {
      "title": "üß† Spherical MoGe Processing",
      "bounding": [25, 375, 1065, 250],
      "color": "#3f789e"
    },
    {
      "title": "üéØ Object Detection & Masking",
      "bounding": [25, 675, 1065, 250],
      "color": "#a1309b"
    },
    {
      "title": "üèóÔ∏è Layer Building & Completion",
      "bounding": [1075, 375, 715, 475],
      "color": "#539e44"
    },
    {
      "title": "üåê Mesh Generation & Export",
      "bounding": [1775, 375, 415, 200],
      "color": "#b06634"
    },
    {
      "title": "üëÅÔ∏è Preview Outputs",
      "bounding": [375, 925, 750, 300],
      "color": "#88a"
    },
    {
      "title": "üìñ Documentation & Tips",
      "bounding": [25, 1225, 2050, 200],
      "color": "#666"
    }
  ],
  "config": {},
  "extra": {},
  "version": 0.4
}